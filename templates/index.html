{% extends "base.html" %}
{% block hash_handler %}
    $(function(){
        // Keep a mapping of url-to-container for caching purposes.
        var cache = {
            // If url is '' (no fragment), display this div's content.
            '': $('.bbq-default')
        };

        // Bind an event to window.onhashchange that, when the history state changes,
        // gets the url from the hash and displays either our cached content or fetches
        // new content to be displayed.
        $(window).bind( 'hashchange', function(e) {

            // Get the hash (fragment) as a string, with any leading # removed. Note that
            // in jQuery 1.4, you should use e.fragment instead of $.param.fragment().
            var url = $.param.fragment();
            $( '.bbq-item,.bbq-default,#generalContents' ).hide();
            if(!url) {
                $('.bbq-default').show();
                return;
            }
            if(url=='events'||url=='hospi') {
                $('.bbq-loading').show();
                $('#generalContents').load(url,function(){
                    $('.bbq-loading').hide();
                    $('#generalContents').show();
                });
                return;
            }
            var event_name=url.split('/tab')[0];
            if(cache[event_name]) {
                var event = cache[event_name];
                $('.eventtab').removeClass('on');
                event.find('#etab1').addClass('on');
		var height = $('.tabtext').height();
		var height2 = $('#textbox2').height();
                if(cache[url]) {
                    event.find(".tabtext").html(cache[url]);
			if(height>400)
                    		event.find("#textbox").jScrollPane({showArrows: true,verticalScroll: true, autoReinitialise: true});
			if(height2>345)              
				event.find("#updates").jScrollPane({showArrows: true,verticalScroll: true, autoReinitialise: true});
                } else {
                    $('.bbq-loading').show();
                    event.find(".tabtext").load( url, function(){
                                // Content loaded, hide "loading" content.
                                $( '.bbq-loading' ).hide();
				if(height>400)
                                event.find("#textbox").jScrollPane({showArrows: true,verticalScroll: true, autoReinitialise: true});
				if(height2>345)
                                event.find("#updates").jScrollPane({showArrows: true,verticalScroll: true, autoReinitialise: true});
                                resetabs();
                                cache[url] = event.find(".tabtext").html();
                        });
                }
                event.show();
            } else {
                if(url.split('submission/')[1]) {
                    // Show "loading" content while AJAX content loads.
                    $( '.bbq-loading' ).show();
                    if (url.split('ques/')[1]) {
                        $(".bbq-item #q_detail").load( url, function(){
                                // Content loaded, hide "loading" content.
                                $( '.bbq-item' ).show();
                            });
                    } else {
                        $('.bbq-loading').show();
                        $(".bbq-item #tabtext").load( url, function(){
                                // Content loaded, hide "loading" content.
                                $('#etab1').addClass('on');
                                $('.bbq-loading').hide();
                                $( '#tabtext' ).show();
                            });
                    }
                } else {
                    cache[event_name] = $( '<div class="bbq-item"></div>' ).appendTo( '.bbq-content' );

                    // Load external content via AJAX. Note that in order to keep this
                    // example streamlined, only the content in .infobox is shown. You'll
                    // want to change this based on your needs.
                    $('.bbq-loading').show();
                    cache[event_name].load( event_name, function(){

                        cache[event_name].find(".tabtext").load( url, function(){
                                    // Content loaded, hide "loading" content.

				if($('.tabtext').height()>400){
                                    cache[event_name].find("#textbox").jScrollPane({showArrows: true,verticalScroll: true, autoReinitialise: true});}
//                                    cache[event_name].find("#updates").jScrollPane({showArrows: true,verticalScroll: true, autoReinitialise: true});}


			if($('#textbox2').height()>345)
                                    cache[event_name].find("#updates").jScrollPane({showArrows: true,verticalScroll: true, autoReinitialise: true});
                                    $( '.bbq-loading' ).hide();
                                    resetabs();
                                    cache[url] = cache[event_name].find(".tabtext").html();
                            });
                        });
                }
            }
        })
        $(window).trigger('hashchange');

    });
{% endblock %}
{% block functions %}
{% endblock %}
{% block events_menu %}
    {% for category in event_set %}
    <div id="menu{{forloop.counter}}"class="menu mentab{{forloop.counter}}">
	    <div id="menutopcolour{{forloop.counter}}" class="menutopcolour">
        </div>
        <div id="menulist{{forloop.counter}}" class="menulist">
        <ul id="menuhead{{forloop.counter}}" class="menuhead">
        	{{category.0.category}}
        </ul>
        <ul id="menus{{forloop.counter}}">
            {% for event in category %}
     		<li onclick="window.location.href='#events/{{event|slugify}}/tab/{{event.tab_set.all.0.title}}';scroll();">{{event.title}}</li>
            {% endfor %}
	    </ul>
        </div>
    </div>
    {% endfor %}
{% endblock %}
{% block footer %}

 <div id="footer">
    
    <div id="tabbox">
    	<div id="tab1" class="tab">
         
        </div>
     <div id="tab2" class="tab">
            
        </div>
     <div id="tab3" class="tab">
            
        </div>
     <div id="tab4" class="tab">
            
        </div>
     <div id="tab5" class="tab">
            
        </div>
     <div id="tab6" class="tab">
            
        </div>
     <div id="tab7" class="tab">
            
        </div>
     <div id="tab8" class="tab">
            
        </div>
     <div id="tab9" class="tab">
            
        </div>
      <div id="tab10" class="tab">
            
        </div>
    </div>
    
    </div>

{% endblock %}
