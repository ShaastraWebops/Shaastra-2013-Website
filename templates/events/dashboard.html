<html>
<head>{% load dajaxice_templatetags %}
<script language = 'JavaScript' type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" charset = "utf-8"></script>
<script language = 'JavaScript' type="text/javascript" src="/static/js/jquery.ba-serializeobject.min.js" charset = "utf-8"></script>
<script language = 'JavaScript' type="text/javascript" src="/static/js/jquery.dajax.core.js" charset = "utf-8"></script>
<script type="text/javascript" charset = "utf-8">

// not documenting this for now. Try n see all the templates in the ajax folder. These functions are called from those templates.
// make a note of all the div ids. See how the divs are being changed dynamically by dajax.
function save_tab(){
    data = $('#tab_form').serializeObject();
    Dajaxice.shaastra.events.save_tab(Dajax.process,{'form':data})
    return false;
}

function edit_tab(id){
    data = $('#edit_tab').serializeObject();
    Dajaxice.shaastra.events.save_editted_tab(Dajax.process,{'form':data,'tab_id':id})
    return false;
}

function validateForm() {                   //prevents display name from being empty
    var x=document.forms["TabFileForm"]["display_name"].value;
    if (x==null || x=="")
    {
    alert("name must be filled out");
    return false;
    }
    // validation for empty file field here. Works even without it for now, an error is shown in firebug.
    return true;
}

function File(id){
    if (validateForm()){
    var name = document.forms["TabFileForm"]["display_name"].value;
    var fileInput = document.getElementById('thefile');
    var file = fileInput.files[0];
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/tabfile/', true);
    xhr.setRequestHeader('X-CSRFToken', '{{csrf_token}}');
    xhr.setRequestHeader('X-Tab-Id', id);
    xhr.setRequestHeader("X-File-Name", file.name);
    xhr.setRequestHeader('X-Name', name);
    xhr.onreadystatechange = function () {                      // read ajax onreadystatechange responses
        if ((xhr.readyState == 4) && (xhr.status == 200)){
            document.getElementById('file_list').innerHTML = xhr.responseText;
        }
        if (xhr.readyState == 1){
        document.getElementById('uploading').innerHTML = "<img src = '/static/js/loading.gif'>";    //loading..loading..
        }
        if (xhr.readyState == 4){
        document.getElementById('uploading').innerHTML = "";    //loading done
        }
    }
    xhr.send(file);                                     // this takes the data to /tabfile/ which will take it to the class view TabFileSubmit
}
}
</script>

{% dajaxice_js_import %}

</head>
<h3>Dashboard for {{request.user.get_profile.is_coord_of.title}}</h3>
{% csrf_token %}
<div name="tabs" id = "tabs">
{% for tab in tabs %}
<div name = "{{tab.title}}" id = "{{tab.title}}" onclick = "Dajaxice.shaastra.events.load_tab(Dajax.process,{'tab_id':'{{tab.id}}'})">{{tab.title}}</div>
{% endfor %}
</div>
<div name = "{{tab.title}}" id = "{{tab.title}}" onclick = "Dajaxice.shaastra.events.add_tab(Dajax.process,{})">add a tab</div>
<div name="detail" id="detail"></div>
</html>
