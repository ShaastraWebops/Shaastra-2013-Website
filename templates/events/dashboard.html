{% load dajaxice_templatetags %}
<html>
    <head>
	    <title>Shaastra 2013 | Coord Dashboard</title>
        {% dajaxice_js_import %}
        <link href="{{site_url}}static/css/demo_page.css"  type="text/css" rel="stylesheet">
        <link href="{{site_url}}static/css/demo_table.css"  type="text/css" rel="stylesheet">
        <script language = 'JavaScript' type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" charset = "utf-8"></script>
        <script language = 'JavaScript' type="text/javascript" src="{{site_url}}static/js/jquery.dataTables.js" charset = "utf-8"></script>
        <script language = 'JavaScript' type="text/javascript" src="{{site_url}}static/js/jquery.ba-serializeobject.min.js" charset = "utf-8"></script>
        <script language = 'JavaScript' type="text/javascript" src="{{site_url}}static/js/jquery.dajax.core.js" charset = "utf-8"></script>
        <script type="text/javascript" src="{{site_url}}static/js/jquery.ba-bbq.js"></script>
        <script type="text/javascript" charset = "utf-8">

        // not documenting this for now. Try n see all the templates in the ajax folder. These functions are called from those templates.
        // make a note of all the div ids. See how the divs are being changed dynamically by dajax.
        function save_score(id){
            data = $('#score').serializeObject();
            isnum = /^[-+]?[0-9]+(\.[0-9]+)?$/.test(data.score);
            if(!isnum){alert('enter a valid score');return false;}
            Dajaxice.submissions.save_score(Dajax.process,{'form':data,'sub_id':id})
            return false;
        }

        function send_checklist(){
            data = $('#sub_list').serializeObject();
            if(data.action=='0'){alert('Please select an Action');return false;}
            if(!data.sub_checklist){alert('Select a Submission!');return false;}
            Dajaxice.submissions.send_checklist(Dajax.process,{'form':data})
            return false;
            
        }
        function toggleChecked(status){
            $(".checkbox").each( function(){
                $(this).attr("checked", status);
                })
        }

        function save_mobapptab(){
            $('.bbq-item').html = "<img src = '{{site_url}}static/img/loading.gif'>";
            data = $('#mobapptab_form').serializeObject();
            Dajaxice.events.add_edit_mobapp_tab(Dajax.process,{'form':data})
            return false;
        }

        function save_editted_option(id){
            data = $('#edit_option_form').serializeObject();
            Dajaxice.events.save_editted_option(Dajax.process,{'form':data,'option_id':id})
            return false;
        }

        function save_option(id){
            data = $('#add_option_form').serializeObject();
            Dajaxice.events.save_option(Dajax.process,{'form':data,'ques_id':id})
            return false;
        }

        function delete_option(id){
            var r=confirm("Are you sure you want to delete the option?");
            if(r==true)
            {
                Dajaxice.events.delete_option(Dajax.process,{'option_id':id})
            }
        }

        function delete_mcq(id){
            var r=confirm("Are you sure you want to delete the question?");
            if(r==true)
            {
                Dajaxice.events.delete_mcq(Dajax.process,{'ques_id':id})
            }
        }

        function save_mcq(){
            data = $('#mcq_form').serializeObject();
            ques_id=$("#ques_id").attr('value');
            Dajaxice.events.save_mcq(Dajax.process,{'data':data,'ques_id':ques_id,})
            return false;
        }

        function delete_sub(id){
            var r=confirm("Are you sure you want to delete the question?");
            if(r==true)
            {
                Dajaxice.events.delete_subjective(Dajax.process,{'ques_id':id})
            }
        }

        function save_editted_subjective(id){
            data = $('#edit_subjective_form').serializeObject();
            Dajaxice.events.save_editted_subjective(Dajax.process,{'form':data,'ques_id':id})
            return false;
        }

        function save_subjective(){
            data = $('#add_subjective_form').serializeObject();
            Dajaxice.events.save_subjective(Dajax.process,{'form':data})
            return false;
        }

        function save_tab(){
            data = $('#tab_form').serializeObject();
            tab_id=$("#tab_id").attr('value');
            Dajaxice.events.save_tab(Dajax.process,{'form':data,'tab_id':tab_id,})
            return false;
        }

        function edit_tab(id){
            data = $('#edit_tab').serializeObject();
            Dajaxice.events.save_editted_tab(Dajax.process,{'form':data,'tab_id':id})
            return false;
        }

        function delete_tab(titles,id){
            var r=confirm("Are you sure you want to delete tab "+ titles +id);
//            if(r=="true")
//                Dajaxice.events.delete_tab(Dajax.process,{'tab_id':id})
        }

        function rename_file(id){
            data = $('#file_rename').serializeObject();
            Dajaxice.events.rename_file_done(Dajax.process, {'form':data,'file_id':id})
            return false;
        }

        function validateForm() {                   //prevents display name from being empty
            var x=document.forms["TabFileForm"]["display_name"].value;
            if (x==null || x=="")
            {
            alert("name must be filled out");
            return false;
            }
            // validation for empty file field here. Works even without it for now, an error is shown in firebug.
            return true;
        }

        function File(id){
            if (validateForm()){
            var name = document.forms["TabFileForm"]["display_name"].value;
            var fileInput = document.getElementById('thefile');
            var file = fileInput.files[0];
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/coord/tabfile/', true);
            xhr.setRequestHeader('X-CSRFToken', '{{csrf_token}}');
            xhr.setRequestHeader('X-Tab-Id', id);
            xhr.setRequestHeader("X-File-Name", file.name);
            xhr.setRequestHeader('X-Name', name);
            xhr.onreadystatechange = function () {                      // read ajax onreadystatechange responses
                if ((xhr.readyState == 4) && (xhr.status == 200)){
                    document.getElementById('file_list').innerHTML = xhr.responseText;
                }
                if (xhr.readyState == 1){
                document.getElementById('uploading').innerHTML = "<img src = '/static/js/loading.gif'>";    //loading..loading..
                }
                if (xhr.readyState == 4){
                document.getElementById('uploading').innerHTML = "";    //loading done
                }
            }
            xhr.send(file);                 // this takes the data to /tabfile/ which will take it to the class view TabFileSubmit
        }
        }
        </script>
        <script type="text/javascript" language="javascript">
        $(function(){
                
            // Bind an event to window.onhashchange that, when the history state changes,
            // gets the url from the hash and displays either our cached content or fetches
            // new content to be displayed.
            $(window).bind( 'hashchange', function(e) {

                // Get the hash (fragment) as a string, with any leading # removed. Note that
                // in jQuery 1.4, you should use e.fragment instead of $.param.fragment().
                var url = $.param.fragment();

                // Remove .bbq-current class from any previously "current" link(s).
                $( 'a.bbq-current' ).removeClass( 'bbq-current' );

                if(url)
                {
                    $(".bbq-default").hide();
                    // Add .bbq-current class to "current" nav link(s), only if url isn't empty.
                    url && $( 'a[href="#' + url + '"]' ).addClass( 'bbq-current' );

                    // Show "loading" content while AJAX content loads.
                    $( '.bbq-loading' ).show();
                    // Load external content via AJAX. Note that in order to keep this
                    // example streamlined, only the content in .infobox is shown. You'll
                    // want to change this based on your needs.
                    $('.bbq-item').load( url, function(){
                        // Content loaded, hide "loading" content.
                        $( '.bbq-loading' ).hide();
                        $( '.bbq-item' ).show();
                    });
                }
                else
                {
                    $(".bbq-item").hide();
                    $(".bbq-default").show();
                }
            })
            $(window).trigger('hashchange');
            Dajaxice.events.updateTabs(Dajax.process);
        });
        </script>
    </head>
    <body>
        <h3>Welcome {{request.user}} | <i>{{request.user.get_profile.is_coord_of.title}} coord </i></h3>
        <a href="{{site_url}}user/logout/">Logout</a>
        <a href="{{site_url}}DTVPicker/Summary/">DTVPicker</a>
        <p>
        {% csrf_token %}
        <div name="tabs" id = "tabs">
        </div>
        <a href="#customtabs">Add a Tab</a>
        <hr/>
        <div class="bbq" id="detail">              
            <div class="bbq-content">

                <!-- This will be shown while loading AJAX content. You'll want to get an image that suits your design at http://ajaxload.info/ -->
                <div class="bbq-loading" style="display:none;">
                    <img src="{{site_url}}static/img/loading.gif" alt="Loading"/> Loading content...
                </div>

                <!-- This content will be shown if no path is specified in the URL fragment. -->
                <div class="bbq-default">
                <i> Click on a Tab you would like to view </i>
                </div>

                <div class="bbq-item">
                </div>
            </div>
        </div>
    </body>
</html>
