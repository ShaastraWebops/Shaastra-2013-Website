{% load dajaxice_templatetags %}
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://ogp.me/ns/fb#">
    <head>
        <title>Shaastra 2013</title>
	    <script type="text/javascript">
        function show(event_id){
            $('#content').fadeOut();
            $('#content').load('{{site_url}}fb/events/'+event_id,function(){FB.XFBML.parse(document.getElementById('content'));         $('#content').fadeIn();});
        }
        </script>
        <link type="text/css" rel="stylesheet" href="{{site_url}}static/css/bootstrap.css">
        <link type="text/css" rel="stylesheet" href="{{site_url}}static/css/fbapp.css">
        <link rel="stylesheet" type="text/css" href="{{site_url}}static/css/jquery.autocomplete.css" /><!--For search-->
    </head>
    <body>
	    <div id="fb-root"></div>
	    <script>
        window.fbAsyncInit = function() {
            FB.init({
                appId      : '291744470918252', // App ID
                channelUrl : '//www.shaastra.org/2013/main/test/static/fb/channel.html', // Channel File
                status     : true, // check login status
                cookie     : true, // enable cookies to allow the server to access the session
                xfbml      : true  // parse XFBML
            });

            // Additional initialization code here
            FB.getLoginStatus(function(response) {
                if(response.status === 'connected') {
                    uid = response.authResponse.userID;
                    accessToken = response.authResponse.accessToken;
                    $('#profile').html("<fb:profile-pic uid="+uid+" linked='true' />");
                    FB.api('/me', function(response) {
                        userDetails = response;
                        $("#profile").prepend("<strong>Welcome " + userDetails.name + "</strong>");
                    });
                } else if(response.status === 'not_authorized') {
			FB.login(function(response) {
			   if (response.authResponse) {
			     alert('Welcome!  Fetching your information.... ');
			     FB.api('/me', function(response) {
			       alert('Good to see you, ' + response.name + '.');
			     });
			   } else {
			     alert('User cancelled login or did not fully authorize.');
			   }
			 });
                }
            });	
        };

        // Load the SDK Asynchronously
        (function(d){
            var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement('script'); js.id = id; js.async = true;
            js.src = "//connect.facebook.net/en_US/all.js";
            ref.parentNode.insertBefore(js, ref);
        }(document));
	    </script>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="navbar navbar-fixed-top">
                    <div class="navbar-inner">
                        <div class="container">
                        <ul class="nav">
                            <li><a href="http://www.shaastra.org/" target="_blank"><img id="logo" src="{{site_url}}static/img/shaastralogo.png" alt="<h2>Shaastra 2013</h2>"/></a></li>
                            <li><a href="#">Home</a></li>
                            <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                            Events
                            <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu">
                            <div class="accordion" id="eventsMenu">
                            {% for category in event_set %}
                            <li>
                            <div class="accordion-group">
                                <div style="color:black;" class="accordion-heading">
                                <a class="accordion-toggle" data-toggle="collapse" data-target="#{{category.0.category|slugify}}" data-parent="#eventsMenu">{{category.0.category}}</a>
                                </div>
                                <div id="{{category.0.category|slugify}}" class="accordion-body collapse">
                                        <ul>
                                        {% for event in category %}
                                 		<li><a href="#" onclick="show({{event.id}});">{{event.title}}</a></li>
                                        {% endfor %}
                                        </ul>
                                </div>
                            </div>
                            </li>
                            {% endfor %}
                            </div>
                            </ul>
                            </li>
                            <li><a href="{{site_url}}events/sampark/" target="_blank">Sampark</a></li>
                            <li><a href="{{site_url}}" target="_blank">Hospitality</a></li>
                            <li><a href="{{site_url}}" target="_blank">Sponsorship</a></li>
                            <li><a href="http://forums.shaastra.org/" target="_blank">Forums</a></li>
                            <li class="divider-vertical"></li>
                            <form class="navbar-search pull-left">
                                <input id="search_query" type="text" class="search-query" placeholder="Search Events">
                            </form><tab>
                        </ul>
                        </div>
                    </div>
                </div>
            </div><br>
            <div id="container" class="row-fluid">
                <div class="span2 well">
                    <div id="profile" class="row-fluid">

                    </div>
                </div>
                <div class="span10">
                    <div id="content" class="row-fluid">
                    <!--Body content-->
                    Event Details comes here!
                    </div>
                </div>
            </div>
        </div>
        <script language = 'JavaScript' type="text/javascript" src="{{site_url}}static/js/jquery.dajax.core.js" charset = "utf-8"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
        <script language = 'JavaScript' type="text/javascript" src="{{site_url}}static/js/bootstrap-dropdown.js" charset = "utf-8"></script>
        <script language = 'JavaScript' type="text/javascript" src="{{site_url}}static/js/bootstrap-collapse.js" charset = "utf-8"></script>
        <script language = 'JavaScript' type="text/javascript" src="{{site_url}}static/js/bootstrap-transition.js" charset = "utf-8"></script>
        <script language = 'JavaScript' type="text/javascript" src="{{site_url}}static/js/bootstrap-carousel.js" charset = "utf-8"></script>
        <script type="text/javascript">
        $(document).ready(function(){
            $('.dropdown-toggle').dropdown();
            $(".collapse").collapse();
            $('#content').load('{{site_url}}fb/hero/',function(){$('.carousel').carousel({interval: 3000});});
        });
	    </script>
        <!--Script to search-->
        <script type='text/javascript' src="{{site_url}}static/js/jquery.autocomplete.js"></script>
        <script type="text/javascript">
        function findValue(li) {
	        if( li == null ) return alert("No match!");

	        // if coming from an AJAX call, using EventID as sValue
	        if( !!li.extra ) var sValue = li.extra[0];

	        // otherwise, using EventName
	        else var sValue = li.selectValue;
            
            //event details location	    
	        show(sValue);
        }

        function selectItem(li) {
	        findValue(li);
        }

        function formatItem(row) {
	        return row[0];
        }

        function lookupLocal(){
	        var oSuggest = $("#search_query")[0].autocompleter;

	        oSuggest.findValue();

	        return false;
        }

        $(document).ready(function() {
	        $("#search_query").autocompleteArray(
		        {{ result_list|safe }},
		        {
			        delay:10,
			        minChars:1,
			        onItemSelect:selectItem,
			        onFindValue:findValue,
			        autoFill:false
		        }
	        );
        });
        </script>
        <!--End of Search script-->
    </body>
</html>